# Minimal Dockerfile for Eshway Assignment - IntelOwl Issue #3156
# This Dockerfile sets up a minimal environment to run the big file upload tests
#
# Build: docker build -f Dockerfile.test -t intelowl-test .
# Run:   docker run --rm intelowl-test ./test.sh new

FROM python:3.11-slim

# Set environment variables
ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    DJANGO_SETTINGS_MODULE=intel_owl.settings

WORKDIR /app

# Install system dependencies
RUN apt-get update && apt-get install -y --no-install-recommends \
    gcc \
    libpq-dev \
    && rm -rf /var/lib/apt/lists/*

# Copy requirements first for better caching
COPY requirements/ requirements/

# Install Python dependencies
RUN pip install --no-cache-dir -r requirements/project-requirements.txt \
    -r requirements/django-server-requirements.txt \
    -r requirements/hardcoded-requirements.txt \
    -r requirements/certego-requirements.txt \
    -r requirements/test-requirements.txt

# Copy application code
COPY . .

# Make test script executable
RUN chmod +x test.sh

# Default command runs the new tests
CMD ["./test.sh", "new"]
